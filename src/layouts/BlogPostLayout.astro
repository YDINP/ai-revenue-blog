---
import BaseLayout from './BaseLayout.astro';
import CoupangBanner from '../components/CoupangBanner.astro';
import AdSlot from '../components/AdSlot.astro';

interface Props {
  title: string;
  description: string;
  pubDate: Date;
  updatedDate?: Date;
  author: string;
  category: string;
  tags: string[];
  image?: { url: string; alt: string };
  coupangLinks?: { title: string; url: string; imageUrl?: string }[];
}

const {
  title,
  description,
  pubDate,
  updatedDate,
  author,
  category,
  tags,
  image,
  coupangLinks,
} = Astro.props;

const formattedDate = new Date(pubDate).toLocaleDateString('ko-KR', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});

// JSON-LD structured data for SEO
const canonicalUrl = Astro.url.href;
const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'Article',
  headline: title,
  description: description,
  datePublished: pubDate.toISOString(),
  ...(updatedDate && { dateModified: updatedDate.toISOString() }),
  author: {
    '@type': 'Person',
    name: author,
  },
  publisher: {
    '@type': 'Organization',
    name: 'TechFlow Blog',
    url: 'https://ai-revenue-blog.vercel.app',
  },
  mainEntityOfPage: {
    '@type': 'WebPage',
    '@id': canonicalUrl,
  },
  keywords: tags.join(', '),
  ...(image && {
    image: {
      '@type': 'ImageObject',
      url: image.url,
      alt: image.alt,
    },
  }),
};
---

<BaseLayout title={title} description={description} image={image?.url}>
  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
  
  <article class="blog-post">
    <header class="post-header">
      <div class="post-meta">
        <span class="post-category">{category}</span>
        <time datetime={pubDate.toISOString()}>{formattedDate}</time>
        {
          updatedDate && (
            <span class="post-updated">
              (수정:{' '}
              {new Date(updatedDate).toLocaleDateString('ko-KR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
              })}
              )
            </span>
          )
        }
      </div>
      <h1>{title}</h1>
      <p class="post-description">{description}</p>
      <div class="post-tags">
        {tags.map((tag) => <span class="tag">#{tag}</span>)}
      </div>
    </header>

    {image && <img src={image.url} alt={image.alt} class="post-hero-image" />}

    <!-- 상단 광고 슬롯 -->
    <AdSlot position="top" />

    <div class="post-content">
      <slot />
    </div>

    <!-- 쿠팡 추천 상품 -->
    {coupangLinks && coupangLinks.length > 0 && (
      <CoupangBanner links={coupangLinks} />
    )}

    <!-- 관련 글 안내 -->
    <div class="post-cta">
      <p>이 글이 도움이 되셨다면 <a href="/blog/">다른 글</a>도 확인해보세요.</p>
    </div>

    <!-- 하단 광고 슬롯 -->
    <AdSlot position="bottom" />
  </article>
</BaseLayout>
