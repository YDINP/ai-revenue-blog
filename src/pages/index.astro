---
import BaseLayout from '../layouts/BaseLayout.astro';
import PostCard from '../components/PostCard.astro';
import NewsletterCTA from '../components/NewsletterCTA.astro';
import PopularPosts from '../components/PopularPosts.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const sortedPosts = allPosts.sort(
  (a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
);
const recentPosts = sortedPosts.slice(0, 6);
---

<BaseLayout
  title="TechFlow - AI & 테크 인사이트"
  description="AI, 개발, 테크 트렌드에 대한 실용적인 인사이트와 리뷰를 제공합니다."
>
  <!-- JSON-LD ItemList for SEO -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "ItemList",
    "itemListElement": recentPosts.map((post, i) => ({
      "@type": "ListItem",
      "position": i + 1,
      "url": `https://ai-revenue-blog.vercel.app/blog/${post.id}/`
    }))
  })} />

  <section class="hero" aria-label="사이트 소개">
    <h1>AI & 테크 인사이트 - 최신 기술 트렌드 블로그</h1>
    <p>최신 AI 도구, 개발 팁, 테크 제품 리뷰를 매일 업데이트합니다.</p>
  </section>

  <section aria-label="최신 글 목록">
    <div class="section-header">
      <h2>최신 글</h2>
      <a href="/blog/" class="section-link">전체 보기 &rarr;</a>
    </div>
    <div class="post-grid">
      {
        recentPosts.map((post) => (
          <PostCard
            title={post.data.title}
            description={post.data.description}
            pubDate={post.data.pubDate}
            category={post.data.category}
            slug={post.id}
            image={post.data.image}
          />
        ))
      }
    </div>
  </section>

  <!-- Popular Posts Widget -->
  <section aria-label="인기 글">
    <PopularPosts />
  </section>

  <!-- Newsletter CTA -->
  <section aria-label="뉴스레터 구독">
    <NewsletterCTA />
  </section>
</BaseLayout>
