---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostCard from '../../components/PostCard.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const sortedPosts = allPosts.sort(
  (a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
);
---

<BaseLayout
  title="Blog"
  description="AI, 개발, 테크 트렌드에 대한 모든 글을 확인하세요."
>
  <div class="blog-header">
    <div>
      <h1>Blog</h1>
      <p style="color: var(--color-text-secondary);">
        총 {sortedPosts.length}개의 글
      </p>
    </div>
    <div class="view-toggle" id="view-toggle">
      <button class="view-btn active" data-view="grid" aria-label="그리드 보기" title="그리드 보기">
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><rect x="1" y="1" width="7" height="7" rx="1.5" stroke="currentColor" stroke-width="1.5"/><rect x="10" y="1" width="7" height="7" rx="1.5" stroke="currentColor" stroke-width="1.5"/><rect x="1" y="10" width="7" height="7" rx="1.5" stroke="currentColor" stroke-width="1.5"/><rect x="10" y="10" width="7" height="7" rx="1.5" stroke="currentColor" stroke-width="1.5"/></svg>
      </button>
      <button class="view-btn" data-view="list" aria-label="리스트 보기" title="리스트 보기">
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none"><rect x="1" y="2" width="16" height="3" rx="1" stroke="currentColor" stroke-width="1.5"/><rect x="1" y="7.5" width="16" height="3" rx="1" stroke="currentColor" stroke-width="1.5"/><rect x="1" y="13" width="16" height="3" rx="1" stroke="currentColor" stroke-width="1.5"/></svg>
      </button>
    </div>
  </div>

  <div class="post-grid" id="post-container">
    {
      sortedPosts.map((post) => (
        <PostCard
          title={post.data.title}
          description={post.data.description}
          pubDate={post.data.pubDate}
          category={post.data.category}
          slug={post.id}
          image={post.data.image}
        />
      ))
    }
  </div>

  <script>
    (function() {
      const container = document.getElementById('post-container');
      const buttons = document.querySelectorAll('.view-btn');
      const saved = localStorage.getItem('blog-view') || 'grid';

      function setView(view) {
        if (!container) return;
        container.className = view === 'list' ? 'post-list' : 'post-grid';
        buttons.forEach(b => b.classList.toggle('active', b.dataset.view === view));
        localStorage.setItem('blog-view', view);
      }

      setView(saved);
      buttons.forEach(b => b.addEventListener('click', () => setView(b.dataset.view)));
    })();
  </script>
</BaseLayout>
